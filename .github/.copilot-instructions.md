# B2B E-commerce Platform - Copilot Instructions

## Project Overview

This is a B2B e-commerce platform for 4Tparts built with Vue 3, TypeScript, and Vite, using Firebase as the backend. The platform is designed for business-to-business sales with features like authentication-gated access, role-based permissions, and a comprehensive admin panel for managing products, users, and orders.

## Key Technologies

- **Frontend**: Vue 3 (Composition API with `<script setup>`), TypeScript, Pinia for state management, Vue Router for navigation, and Tailwind CSS for styling.
- **Backend**: Firebase (Authentication, Firestore, Cloud Functions for server-side logic like Stripe integration).
- **Payments**: Stripe integration for creating and managing invoices.
- **Deployment**: The project is set up for deployment on Cloudflare Pages, with Firebase Functions for the backend logic.

## Core Features & User Flows

### 1. Authentication and User Management

- **Role-Based Access Control**: The application distinguishes between two main user roles: customer and admin. Access to different parts of the application is restricted based on these roles.
- **User Verification**: New customer accounts require verification by an admin before they can place orders. Unverified users are redirected to a "pending verification" page.
- **Secure Authentication**: Firebase Authentication is used for user login and registration. The `useAuthStore` in `src/stores/auth.ts` manages the user's authentication state.

### 2. Product Catalog and Management

- **Product Listings**: Products are displayed in a catalog with search and filtering capabilities. The `useProductStore` in `src/stores/products.ts` handles all product-related data.
- **Admin Product Management**: Admins can add, edit, and delete products through the admin panel. This includes managing details like images, pricing, stock levels, and specifications.
- **Image Uploads**: Product images are uploaded to a Cloudflare R2 bucket via a presigned URL generated by a Cloudflare Worker, as seen in `workers/src/image-handler.js`.

### 3. Shopping Cart and Checkout

- **Shopping Cart**: Users can add products to a shopping cart, which is managed by the `useCartStore` in `src/stores/cart.ts`.
- **Checkout Process**: The checkout process allows users to provide a shipping address and place an order. For B2B customers, this creates an invoice with a 30-day payment term.
- **Order Management**: The `useOrderStore` in `src/stores/orders.ts` handles the creation of new orders.

### 4. Stripe Integration for Payments

- **Invoice Generation**: When a user places an order, a Firebase Function (`createInvoice` in `functions/src/functions/payments.js`) is triggered to create an invoice in Stripe.
- **Webhooks**: The application uses Stripe webhooks to listen for events like `invoice.payment_succeeded` and `invoice.created`, as configured in `functions/src/functions/webhooks.js`.
- **Telegram Notifications**: The system is set up to send notifications to a Telegram channel for events like new invoices and successful payments, as seen in `functions/src/config/telegram.js`.

## Technical Implementation Details

### Firebase Collections Structure

- **users**: Stores user profiles, including their role, verification status, and company information.
- **products**: Contains all product data, such as name, price, description, and images.
- **orders**: Records all placed orders, including items, shipping details, and total amount.
- **invoices**: Stores information about generated invoices, linking them to users and orders.

### State Management with Pinia

- **useAuthStore**: Manages user authentication, profile data, and role-based access.
- **useProductStore**: Handles fetching and managing product data.
- **useCartStore**: Manages the shopping cart's state, including adding, removing, and updating items.
- **useOrderStore**: Responsible for creating and managing orders.
- **useNotificationStore**: Manages the display of toast notifications for user feedback.

### Key File Locations

- **Vue Components**: Located in `src/components`, organized by feature (e.g., admin, cart, auth).
- **Pinia Stores**: All state management logic is in `src/stores`.
- **Firebase Functions**: Server-side logic can be found in the `functions/src` directory.
- **Routing**: The application's routes are defined in `src/router/index.ts`.
- **Type Definitions**: TypeScript types are located in the `src/types` directory.
