name = "b2b-api-gateway"
main = "src/index.ts"
compatibility_date = "2024-11-01"

# ============================================================================
# D1 DATABASE (Production - Primary data store)
# ============================================================================
# Direct database access via @b2b/db package
[[d1_databases]]
binding = "DB"
database_name = "b2b-prod"
database_id = "7cc12490-bd4c-42dc-a3eb-1dc290a864a0"

# ============================================================================
# SERVICE BINDINGS (Production - External services only)
# ============================================================================
# Only services that handle external APIs or require isolation

[[services]]
binding = "STRIPE_SERVICE"
service = "b2b-stripe-service"

[[services]]
binding = "SHOPIFY_SYNC_SERVICE"
service = "b2b-shopify-sync-service"

[[services]]
binding = "TELEGRAM_SERVICE"
service = "b2b-telegram-service"

# Queue Binding for Email Service (async processing)
[[queues.producers]]
queue = "b2b-email-queue"
binding = "EMAIL_QUEUE"

# Production vars (used when no --env specified)
[vars]
ENVIRONMENT = "production"
ALLOWED_ORIGINS = "https://4tparts.com"

# ============================================================================
# DEVELOPMENT ENVIRONMENT
# ============================================================================
[env.dev]
name = "b2b-api-gateway-dev"

# D1 Database binding (dev)
[[env.dev.d1_databases]]
binding = "DB"
database_name = "b2b-dev"
database_id = "0420eb79-c871-4fdb-bbf3-6deb62d5c0c3"

# Service bindings (dev) - External services only
[[env.dev.services]]
binding = "STRIPE_SERVICE"
service = "b2b-stripe-service-dev"

[[env.dev.services]]
binding = "SHOPIFY_SYNC_SERVICE"
service = "b2b-shopify-sync-service-dev"

[[env.dev.services]]
binding = "TELEGRAM_SERVICE"
service = "b2b-telegram-service-dev"

# Queue Binding for Email Service (dev)
[[env.dev.queues.producers]]
queue = "b2b-email-queue-dev"
binding = "EMAIL_QUEUE"

[env.dev.vars]
ENVIRONMENT = "development"
ALLOWED_ORIGINS = "http://localhost:5174,http://localhost:4173, https://b2b-frontend-4u8.pages.dev/"


[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true
