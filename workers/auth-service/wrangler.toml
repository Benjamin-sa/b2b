name = "b2b-auth-service"
main = "src/index.ts"
compatibility_date = "2024-11-01"

# Top-level bindings (used when no --env specified)
[[d1_databases]]
binding = "DB"
database_name = "b2b-prod"
database_id = "7cc12490-bd4c-42dc-a3eb-1dc290a864a0"

[[kv_namespaces]]
binding = "SESSIONS"
id = "201d05bf84a94e50a0f5c76213f700e3"

# Service binding for Stripe operations (no HTTP overhead!)
[[services]]
binding = "STRIPE_SERVICE"
service = "b2b-stripe-service"

# Top-level vars (used when no --env specified)
[vars]
ENVIRONMENT = "production"
ACCESS_TOKEN_TTL = "3600"
REFRESH_TOKEN_TTL = "2592000"
PASSWORD_MIN_LENGTH = "8"
ALLOWED_ORIGINS = "http://localhost:5173,http://localhost:4173,https://yourdomain.com"

# Observability configuration (applies to production/top-level)
[observability]
enabled = true

[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true

# Development environment
[env.dev]
name = "b2b-auth-service-dev"

[env.dev.observability]
enabled = true

[env.dev.observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true

[[env.dev.d1_databases]]
binding = "DB"
database_name = "b2b-dev"
database_id = "0420eb79-c871-4fdb-bbf3-6deb62d5c0c3"

[[env.dev.kv_namespaces]]
binding = "SESSIONS"
id = "a4a763a378dd47da9c9596a8494fa2c0"

# Service binding for dev environment
[[env.dev.services]]
binding = "STRIPE_SERVICE"
service = "b2b-stripe-service-dev"

[env.dev.vars]
ENVIRONMENT = "development"
ACCESS_TOKEN_TTL = "3600"          # 1 hour in seconds
REFRESH_TOKEN_TTL = "2592000"      # 30 days in seconds
PASSWORD_MIN_LENGTH = "8"
ALLOWED_ORIGINS = "http://localhost:5173,http://localhost:4173"

# Production environment
[env.prod]
name = "b2b-auth-service"

[[env.prod.d1_databases]]
binding = "DB"
database_name = "b2b-prod"
database_id = "7cc12490-bd4c-42dc-a3eb-1dc290a864a0"

[[env.prod.kv_namespaces]]
binding = "SESSIONS"
id = "201d05bf84a94e50a0f5c76213f700e3"

[env.prod.vars]
ENVIRONMENT = "production"
ACCESS_TOKEN_TTL = "3600"
REFRESH_TOKEN_TTL = "2592000"
PASSWORD_MIN_LENGTH = "8"
ALLOWED_ORIGINS = "https://yourdomain.com"

# Secrets to set via: wrangler secret put <NAME> --env <dev|prod>
# - JWT_SECRET (for signing access tokens)
# - REFRESH_SECRET (for signing refresh tokens)
# - STRIPE_SECRET_KEY (optional, for Stripe customer sync)
